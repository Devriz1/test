<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Store â€” Dummy Payment Test</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#2b7de9}
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);margin:0;padding:24px;color:#222}
    .container{max-width:720px;margin:0 auto;text-align:center}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 16px rgba(25,25,25,0.06);margin:18px auto}
    .price{font-size:20px;margin:8px 0}
    button{background:var(--accent);border:none;color:#fff;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    #confirmBox{display:none;margin-top:20px}
    .success{display:none;margin-top:18px;padding:12px;border-radius:8px;background:#e6f7e6;color:#123912}
    input[type=text], input[type=email]{padding:8px;border-radius:6px;border:1px solid #ddd;width:100%;margin:8px 0}
    /* Modal styles for dummy payment page */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{background:#fff;padding:20px;border-radius:10px;min-width:300px;box-shadow:0 10px 30px rgba(0,0,0,0.2);text-align:left}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <h1>Simple Store â€” Dummy Payment</h1>

    <div class="card">
      <h3>Stylish Hoodie</h3>
      <p class="price">â‚¹499</p>
      <p class="muted">(Dummy GPay flow â€” for testing)</p>
      <div style="margin-top:12px">
        <button id="buyBtn">Buy Now</button>
      </div>
    </div>

    <div id="confirmBox" class="card">
      <h3>Confirm Payment</h3>
      <p>After completing the payment in the dummy window, click below to submit your order to the server.</p>
      <label for="txnInput">Transaction ID (auto-filled by dummy):</label>
      <input id="txnInput" type="text" placeholder="TXN..." />
      <div style="margin-top:10px">
        <button id="confirmBtn">âœ… I Have Paid</button>
      </div>
    </div>

    <div id="successMessage" class="success">ðŸŽ‰ Order Confirmed! A confirmation email has been sent to you.</div>
  </div>

  <!-- Dummy Payment Modal (simulates GPay) -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>Dummy GPay â€” Simulate Payment</h3>
      <p class="muted">This is a fake payment screen used only for testing. Click the button to simulate a successful payment.</p>
      <div style="margin-top:12px">
        <button id="simulateSuccess">Simulate Payment Success</button>
        <button id="simulateCancel" style="margin-left:10px;background:#888">Cancel</button>
      </div>
    </div>
  </div>

<script>
/*
  Dummy GPay flow for testing
  - Replaces mobile UPI intent with an in-browser modal.
  - Auto-generates a transaction id and populates txn input on "payment success".
  - After that, user clicks "I Have Paid" which posts to your Apps Script web app (replace URL below).
*/

// ======= CONFIG =======
const scriptBaseURL = 'https://script.google.com/macros/s/AKfycbzpB3XI4f9PvM9Jorj4T3NUdnD0UrpISULg3HID_J3GlGFiUfREXtLbAXAQGwBRuj2n/exechttps://script.google.com/macros/s/AKfycby4nXfEMFhfeOiw8vasPtp8GxGq9x32Jb_-L9YQk58/devhttps://script.google.com/macros/s/AKfycbzpB3XI4f9PvM9Jorj4T3NUdnD0UrpISULg3HID_J3GlGFiUfREXtLbAXAQGwBRuj2n/exechttps://script.google.com/macros/s/AKfycbzTIXdKBqeOpTTmtlecDXOOTA3lsWawS6_A7eGG--s69igB0xJuiYig6HQpJMbd_VRI/exec'; // <<-- REPLACE this with your Apps Script Web App URL

// ======= STATE =======
let pendingOrder = null;

// ======= UI ELEMENTS =======
const buyBtn = document.getElementById('buyBtn');
const confirmBox = document.getElementById('confirmBox');
const confirmBtn = document.getElementById('confirmBtn');
const successMessage = document.getElementById('successMessage');
const txnInput = document.getElementById('txnInput');

const modalBackdrop = document.getElementById('modalBackdrop');
const simulateSuccess = document.getElementById('simulateSuccess');
const simulateCancel = document.getElementById('simulateCancel');

// ======= PURCHASE FLOW =======
buyBtn.addEventListener('click', () => {
  // Collect basic buyer info
  const name = prompt('Enter your full name:');
  if (!name) return alert('Name is required');
  const email = prompt('Enter your email:');
  if (!email || !validateEmail(email)) return alert('Valid email is required');

  // create a temporary pending order
  const product = 'Stylish Hoodie';
  const amount = 499;
  const clientTxn = 'TEMP-' + Date.now(); // temporary txn; will be replaced by dummy success
  pendingOrder = { name, email, product, amount, transactionId: clientTxn };

  // Show dummy payment modal (simulating opening GPay)
  openDummyPayment();
});

function openDummyPayment() {
  modalBackdrop.style.display = 'flex';
}

// Simulate the user successfully paying in the UPI app
simulateSuccess.addEventListener('click', () => {
  // generate a real-looking transaction id (simulate bank/UPI txn)
  const simulatedTxn = 'TXN' + Date.now();
  // populate pending order with simulated txn id
  if (pendingOrder) pendingOrder.transactionId = simulatedTxn;

  // fill txn field in confirm box so user sees it
  txnInput.value = simulatedTxn;

  // close modal & show confirm UI
  modalBackdrop.style.display = 'none';
  confirmBox.style.display = 'block';
});

// Cancel dummy payment
simulateCancel.addEventListener('click', () => {
  modalBackdrop.style.display = 'none';
  alert('Payment cancelled. You can try again.');
  // keep pendingOrder in case they retry
});

// ======= CONFIRM & POST TO APPS SCRIPT =======
confirmBtn.addEventListener('click', () => {
  if (!pendingOrder) return alert('No pending order â€” click Buy Now first');

  // If user edited txnInput, prefer that
  const manualTxn = txnInput.value && txnInput.value.trim();
  if (manualTxn) pendingOrder.transactionId = manualTxn;

  // Post order to Apps Script
  fetch(scriptBaseURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(pendingOrder)
  })
  .then(response => {
    // Apps Script may return plain text or JSON depending on your script.
    // Try parse safely:
    return response.text();
  })
  .then(text => {
    // show success UI
    confirmBox.style.display = 'none';
    successMessage.style.display = 'block';

    // clear local state
    pendingOrder = null;
    txnInput.value = '';
  })
  .catch(err => {
    alert('Failed to send order to server: ' + err);
  });
});

// ======= UTIL =======
function validateEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}
</script>
</body>
</html>
